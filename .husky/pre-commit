#!/bin/sh

# æ©Ÿå¯†æƒ…å ±ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
echo "ğŸ” Checking for sensitive data patterns..."

# APIãƒˆãƒ¼ã‚¯ãƒ³ã‚„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢ï¼ˆ.huskyãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é™¤å¤–ï¼‰
if git diff --cached --name-only | grep -v "^\.husky/" | xargs grep -E "(xoxp-[0-9a-zA-Z]{10,}|xoxb-[0-9a-zA-Z]{10,}|sk-[0-9a-zA-Z]{20,}|pk_[0-9a-zA-Z]{20,}|api_key.*=.*['\"][^'\"]{20,}|password.*=.*['\"][^'\"]+['\"])" 2>/dev/null; then
  echo "âŒ Error: Potential secrets detected in staged files!"
  echo "Please remove sensitive data before committing."
  exit 1
fi

# ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒã‚§ãƒƒã‚¯
if git diff --cached --name-only | grep -E "^\.env($|\.)" | grep -v -E "\.example$|\.sample$"; then
  echo "âŒ Error: Attempting to commit .env file!"
  echo "Environment files should never be committed."
  exit 1
fi

# Biomeã«ã‚ˆã‚‹lintã¨format
echo "ğŸ§¹ Running Biome lint and format..."
npx biome check --write --no-errors-on-unmatched ./src

echo "âœ… Pre-commit checks passed!"