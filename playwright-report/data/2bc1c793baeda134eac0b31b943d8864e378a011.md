# Test info

- Name: Storybook動作確認 >> アクセシビリティ - タブキーでのフォーカス移動が正常に動作する
- Location: /home/nishioka/Develop/notebooklm-collector/tests/storybook.spec.ts:93:7

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toBeFocused()

Locator: locator('#storybook-preview-iframe').contentFrame().locator('input[placeholder="#general"]')
Expected: focused
Received: inactive
Call log:
  - expect.toBeFocused with timeout 5000ms
  - waiting for locator('#storybook-preview-iframe').contentFrame().locator('input[placeholder="#general"]')
    9 × locator resolved to <input value="" type="text" id="channel" placeholder="#general" class="block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-blue-400 focus:border-blue-400 disabled:bg-gray-100 disabled:cursor-not-allowed transition-colors"/>
      - unexpected value "inactive"

    at /home/nishioka/Develop/notebooklm-collector/tests/storybook.spec.ts:116:67
```

# Page snapshot

```yaml
- main:
  - button "Remount component":
    - img
  - button "Zoom in":
    - img
  - button "Zoom out":
    - img
  - button "Reset zoom":
    - img
  - button "Change the background of the preview":
    - img
  - button "Apply a grid to the preview":
    - img
  - button "light":
    - img
    - text: light
  - button "Enable measure":
    - img
  - button "Apply outlines to the preview":
    - img
  - button "Vision simulator":
    - img
  - img
  - button "Change the size of the preview":
    - img
  - button "Go full screen":
    - img
  - link "Open canvas in new tab":
    - /url: iframe.html?globals=&args=&id=components-slackadvancedfilters--expanded
    - img
  - button "Copy canvas link":
    - img
  - link "Skip to sidebar":
    - /url: "#components-slackadvancedfilters--expanded"
  - iframe
- navigation:
  - link "Skip to canvas":
    - /url: "#storybook-preview-wrapper"
  - link "NotebookLM Collector":
    - /url: https://github.com/sotaroNishioka/notebooklm-collector
  - button "Shortcuts":
    - img
  - text: Search for components
  - combobox "Search for components":
    - img
    - searchbox "Search for components"
    - code: ⌃ K
    - button "Tag filters":
      - img
  - button:
    - img
  - img
  - button "Components" [expanded]:
    - img
    - text: Components
  - button "Collapse":
    - img
  - button "MarkdownPreview":
    - img
    - img
    - text: MarkdownPreview
  - button "SlackAdvancedFilters" [expanded]:
    - img
    - img
    - text: SlackAdvancedFilters
  - link "Docs":
    - /url: /?path=/docs/components-slackadvancedfilters--docs
    - img
    - text: Docs
  - link "Default":
    - /url: /?path=/story/components-slackadvancedfilters--default
    - img
    - text: Default
  - link "Expanded":
    - /url: /?path=/story/components-slackadvancedfilters--expanded
    - img
    - text: Expanded
  - link "Skip to canvas":
    - /url: "#storybook-preview-wrapper"
  - link "With Values":
    - /url: /?path=/story/components-slackadvancedfilters--with-values
    - img
    - text: With Values
  - link "Development Team Filter":
    - /url: /?path=/story/components-slackadvancedfilters--development-team-filter
    - img
    - text: Development Team Filter
  - link "Project Management Filter":
    - /url: /?path=/story/components-slackadvancedfilters--project-management-filter
    - img
    - text: Project Management Filter
  - link "Disabled":
    - /url: /?path=/story/components-slackadvancedfilters--disabled
    - img
    - text: Disabled
  - link "Channel Only":
    - /url: /?path=/story/components-slackadvancedfilters--channel-only
    - img
    - text: Channel Only
  - link "Author Only":
    - /url: /?path=/story/components-slackadvancedfilters--author-only
    - img
    - text: Author Only
  - link "Date Range Only":
    - /url: /?path=/story/components-slackadvancedfilters--date-range-only
    - img
    - text: Date Range Only
  - link "Weekly Range":
    - /url: /?path=/story/components-slackadvancedfilters--weekly-range
    - img
    - text: Weekly Range
  - link "Single Day":
    - /url: /?path=/story/components-slackadvancedfilters--single-day
    - img
    - text: Single Day
  - link "Complex Channel Names":
    - /url: /?path=/story/components-slackadvancedfilters--complex-channel-names
    - img
    - text: Complex Channel Names
  - link "Invalid Date Range":
    - /url: /?path=/story/components-slackadvancedfilters--invalid-date-range
    - img
    - text: Invalid Date Range
- tablist:
  - tab "Controls 6"
  - tab "Actions"
  - tab "Accessibility"
- button "Change addon orientation [alt D]":
  - img
- button "Hide addons [alt A]":
  - img
- table:
  - rowgroup:
    - row "Name Control":
      - cell "Name"
      - cell "Control":
        - text: Control
        - button "Reset controls"
  - rowgroup:
    - row "showAdvanced* showAdvanced":
      - cell "showAdvanced*"
      - cell "showAdvanced":
        - switch "showAdvanced" [checked]
    - row "onToggleAdvanced* -":
      - cell "onToggleAdvanced*"
      - cell "-"
    - row "channel*":
      - cell "channel*"
      - cell:
        - textbox
    - row "onChannelChange* -":
      - cell "onChannelChange*"
      - cell "-"
    - row "author*":
      - cell "author*"
      - cell:
        - textbox
    - row "onAuthorChange* -":
      - cell "onAuthorChange*"
      - cell "-"
    - row "startDate*":
      - cell "startDate*"
      - cell:
        - textbox
        - textbox
    - row "onStartDateChange* -":
      - cell "onStartDateChange*"
      - cell "-"
    - row "endDate*":
      - cell "endDate*"
      - cell:
        - textbox
        - textbox
    - row "onEndDateChange* -":
      - cell "onEndDateChange*"
      - cell "-"
    - row "disabled disabled":
      - cell "disabled"
      - cell "disabled":
        - switch "disabled"
```

# Test source

```ts
   16 |
   17 |   test('MarkdownPreview - Default Storyが表示される', async ({ page }) => {
   18 |     await page.goto('/')
   19 |
   20 |     // サイドバーが表示されるまで待機
   21 |     await page.locator('[data-item-id="components"]').waitFor({ state: 'visible' })
   22 |
   23 |     // MarkdownPreviewコンポーネントを展開
   24 |     await page.locator('[data-item-id="components-markdownpreview"]').click()
   25 |     await page.waitForTimeout(500) // アニメーション待機
   26 |
   27 |     // Default Storyを選択
   28 |     await page.locator('[data-item-id="components-markdownpreview--default"]').click()
   29 |     await page.waitForTimeout(1000) // iframeロード待機
   30 |
   31 |     // プレビューエリアでMarkdownPreviewコンポーネントが表示されることを確認
   32 |     const iframe = page.frameLocator('#storybook-preview-iframe')
   33 |     // iframeのコンテンツがロードされるまで待機
   34 |     await iframe.locator('body').waitFor({ state: 'attached' })
   35 |     // h2タグのプレビュータイトルを確認
   36 |     await expect(iframe.locator('h2').filter({ hasText: 'プレビュー' }).first()).toBeVisible()
   37 |
   38 |     // サンプルMarkdownの内容が表示されることを確認
   39 |     await expect(iframe.locator('h1:has-text("サンプルドキュメント")')).toBeVisible()
   40 |     await expect(iframe.locator('h2:has-text("機能一覧")')).toBeVisible()
   41 |   })
   42 |
   43 |   test('MarkdownPreview - Empty Storyが表示される', async ({ page }) => {
   44 |     await page.goto('/')
   45 |
   46 |     // Empty Storyを選択
   47 |     await page.locator('[data-item-id="components-markdownpreview--empty"]').click()
   48 |
   49 |     // 空状態のメッセージが表示されることを確認
   50 |     const iframe = page.frameLocator('#storybook-preview-iframe')
   51 |     await expect(iframe.locator('p:has-text("ここにMarkdownプレビューが表示されます。")')).toBeVisible()
   52 |   })
   53 |
   54 |   test('SlackAdvancedFilters - Default Storyが表示される', async ({ page }) => {
   55 |     await page.goto('/')
   56 |
   57 |     // SlackAdvancedFiltersコンポーネントを展開
   58 |     await page.locator('[data-item-id="components-slackadvancedfilters"]').click()
   59 |
   60 |     // Default Storyを選択
   61 |     await page.locator('[data-item-id="components-slackadvancedfilters--default"]').click()
   62 |
   63 |     // プレビューエリアでコンポーネントが表示されることを確認
   64 |     const iframe = page.frameLocator('#storybook-preview-iframe')
   65 |     // iframeのコンテンツがロードされるまで待機
   66 |     await iframe.locator('body').waitFor({ state: 'attached' })
   67 |     await expect(iframe.locator('button').filter({ hasText: 'もっと詳細な条件を追加する' }).first()).toBeVisible()
   68 |   })
   69 |
   70 |   test('SlackAdvancedFilters - Expanded Storyでフィルターが展開される', async ({ page }) => {
   71 |     await page.goto('/')
   72 |
   73 |     // サイドバーが表示されるまで待機
   74 |     await page.locator('[data-item-id="components"]').waitFor({ state: 'visible' })
   75 |
   76 |     // SlackAdvancedFiltersコンポーネントを展開
   77 |     await page.locator('[data-item-id="components-slackadvancedfilters"]').click()
   78 |     await page.waitForTimeout(500) // アニメーション待機
   79 |
   80 |     // Expanded Storyを選択
   81 |     await page.locator('[data-item-id="components-slackadvancedfilters--expanded"]').click()
   82 |     await page.waitForTimeout(1000) // iframeロード待機
   83 |
   84 |     // フィルター入力フィールドが表示されることを確認
   85 |     const iframe = page.frameLocator('#storybook-preview-iframe')
   86 |     // iframeのコンテンツがロードされるまで待機
   87 |     await iframe.locator('body').waitFor({ state: 'attached' })
   88 |     await expect(iframe.locator('input[placeholder="#general"]')).toBeVisible()
   89 |     await expect(iframe.locator('input[placeholder="@user"]')).toBeVisible()
   90 |     await expect(iframe.locator('input[type="date"]').first()).toBeVisible()
   91 |   })
   92 |
   93 |   test('アクセシビリティ - タブキーでのフォーカス移動が正常に動作する', async ({ page }) => {
   94 |     await page.goto('/')
   95 |
   96 |     // サイドバーが表示されるまで待機
   97 |     await page.locator('[data-item-id="components"]').waitFor({ state: 'visible' })
   98 |
   99 |     // SlackAdvancedFiltersコンポーネントを展開
  100 |     await page.locator('[data-item-id="components-slackadvancedfilters"]').click()
  101 |     await page.waitForTimeout(500) // アニメーション弆機
  102 |
  103 |     // SlackAdvancedFilters Expanded Storyに移動
  104 |     await page.locator('[data-item-id="components-slackadvancedfilters--expanded"]').click()
  105 |     await page.waitForTimeout(1000) // iframeロード待機
  106 |
  107 |     const iframe = page.frameLocator('#storybook-preview-iframe')
  108 |     // iframeのコンテンツがロードされるまで待機
  109 |     await iframe.locator('body').waitFor({ state: 'attached' })
  110 |
  111 |     // Tabキーでフォーカス移動をテスト
  112 |     await iframe.locator('body').click()
  113 |     await page.keyboard.press('Tab')
  114 |
  115 |     // 最初の入力フィールドにフォーカスが当たることを確認
> 116 |     await expect(iframe.locator('input[placeholder="#general"]')).toBeFocused()
      |                                                                   ^ Error: Timed out 5000ms waiting for expect(locator).toBeFocused()
  117 |
  118 |     // 次の入力フィールドにフォーカスが移動することを確認
  119 |     await page.keyboard.press('Tab')
  120 |     await expect(iframe.locator('input[placeholder="@user"]')).toBeFocused()
  121 |   })
  122 |
  123 |   test('レスポンシブ - モバイル表示で適切にレイアウトされる', async ({ page }) => {
  124 |     // モバイルサイズに変更
  125 |     await page.setViewportSize({ width: 375, height: 667 })
  126 |
  127 |     await page.goto('/')
  128 |
  129 |     // サイドバーが表示されるまで待機
  130 |     await page.locator('[data-item-id="components"]').waitFor({ state: 'visible' })
  131 |
  132 |     // MarkdownPreviewコンポーネントを展開
  133 |     await page.locator('[data-item-id="components-markdownpreview"]').click()
  134 |     await page.waitForTimeout(500) // アニメーション待機
  135 |
  136 |     // MarkdownPreview Default Storyを表示
  137 |     await page.locator('[data-item-id="components-markdownpreview--default"]').click()
  138 |     await page.waitForTimeout(1000) // iframeロード待機
  139 |
  140 |     const iframe = page.frameLocator('#storybook-preview-iframe')
  141 |     // iframeのコンテンツがロードされるまで待機
  142 |     await iframe.locator('body').waitFor({ state: 'attached' })
  143 |
  144 |     // モバイルでも適切に表示されることを確認
  145 |     await expect(iframe.locator('h1').filter({ hasText: 'サンプルドキュメント' }).first()).toBeVisible()
  146 |
  147 |     // コンテナが適切な幅で表示されることを確認
  148 |     const container = iframe.locator('.max-w-3xl')
  149 |     await expect(container).toBeVisible()
  150 |   })
  151 |
  152 |   test('ダウンロードボタンが正常に動作する', async ({ page }) => {
  153 |     await page.goto('/')
  154 |
  155 |     // MarkdownPreview Default Storyを表示
  156 |     await page.locator('[data-item-id="components-markdownpreview--default"]').click()
  157 |
  158 |     const iframe = page.frameLocator('#storybook-preview-iframe')
  159 |
  160 |     // ダウンロードボタンが表示されることを確認
  161 |     // iframeのコンテンツがロードされるまで待機
  162 |     await iframe.locator('body').waitFor({ state: 'attached' })
  163 |     const downloadButton = iframe.locator('button').filter({ hasText: 'ダウンロード' }).first()
  164 |     await expect(downloadButton).toBeVisible()
  165 |
  166 |     // ボタンがクリック可能であることを確認
  167 |     await expect(downloadButton).toBeEnabled()
  168 |   })
  169 |
  170 |   test('コードブロックが適切にシンタックスハイライトされる', async ({ page }) => {
  171 |     await page.goto('/')
  172 |
  173 |     // CodeHeavyContent Storyを表示
  174 |     await page.locator('[data-item-id="components-markdownpreview--code-heavy-content"]').click()
  175 |
  176 |     const iframe = page.frameLocator('#storybook-preview-iframe')
  177 |
  178 |     // コードブロックが適切に表示されることを確認
  179 |     // iframeのコンテンツがロードされるまで待機
  180 |     await iframe.locator('body').waitFor({ state: 'attached' })
  181 |     // コードブロックを含むコンテナを特定
  182 |     await expect(iframe.locator('pre').nth(1)).toBeVisible() // Storybookのエラー表示のpreを避ける
  183 |     await expect(iframe.locator('code').first()).toBeVisible()
  184 |
  185 |     // 言語ラベルが表示されることを確認
  186 |     await expect(iframe.locator('.bg-gray-700').filter({ hasText: 'typescript' }).first()).toBeVisible()
  187 |   })
  188 | })
  189 |
```